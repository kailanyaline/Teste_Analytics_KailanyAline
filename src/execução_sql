import pandas as pd
import sqlite3

# 1) Carrega o CSV limpo
df = pd.read_csv("data_clean.csv")

# 2) Cria banco SQLite local (arquivo) e salva tabela vendas
conn = sqlite3.connect("meu_banco.db")
df.to_sql("vendas", conn, if_exists="replace", index=False)

# 3) Consulta 1: faturamento por produto/categoria
query1 = """
SELECT
    Produto,
    Categoria,
    SUM(Quantidade * Preco) AS Total_Vendas
FROM vendas
GROUP BY Produto, Categoria
ORDER BY Total_Vendas DESC;
"""
df_resultado1 = pd.read_sql(query1, conn)
print("\n=== Consulta 1: Faturamento por Produto/Categoria ===")
print(df_resultado1.to_string(index=False))

# 4) Consulta 2: menor volume em junho/2023 (SQLite)
query2 = """
SELECT
    Produto,
    SUM(Quantidade) AS Total_Quantidade
FROM vendas
WHERE strftime('%Y-%m', Data) = '2023-06'
GROUP BY Produto
ORDER BY Total_Quantidade ASC;
"""
df_resultado2 = pd.read_sql(query2, conn)
print("\n=== Consulta 2: Menor volume em Junho/2023 ===")
print(df_resultado2.to_string(index=False))

conn.close()
